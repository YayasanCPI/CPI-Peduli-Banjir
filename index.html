import React, { useState, useEffect } from 'react';
import { Clock, Copy, Phone, Heart, AlertTriangle, CheckCircle, ArrowRight, Send, MessageSquare } from 'lucide-react';

const FloodReliefApp = () => {
  const [timeLeft, setTimeLeft] = useState({ hours: 0, minutes: 0, seconds: 0 });
  const [isExpired, setIsExpired] = useState(false);
  const [copied, setCopied] = useState(false);
  
  // State untuk Input Pesan
  const [inputMessage, setInputMessage] = useState("");
  const [isMessageSent, setIsMessageSent] = useState(false);

  // Data awal running text
  const [messages, setMessages] = useState([
    "Terima kasih Budi S. (Medan) - Rp 500.000",
    "Terima kasih Hamba Allah (Padang) - Rp 1.000.000",
    "Terima kasih Siti A. (Aceh) - Rp 250.000",
    "Solidaritas Alumni Tambang - Rp 5.000.000",
    "Terima kasih Rina W. (Jakarta) - Rp 300.000",
    "Terima kasih Komunitas Peduli - Rp 1.500.000",
    "Doa terbaik untuk saudara di Sumatera.",
    "Semoga banjir segera surut."
  ]);

  // Target: Hari ini, 6 Desember 2025, Pukul 22:00 WIB
  const targetDate = new Date('2025-12-06T22:00:00+07:00').getTime();

  useEffect(() => {
    const interval = setInterval(() => {
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance < 0) {
        clearInterval(interval);
        setIsExpired(true);
        setTimeLeft({ hours: 0, minutes: 0, seconds: 0 });
      } else {
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        setTimeLeft({ hours, minutes, seconds });
      }
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  const handleCopy = () => {
    navigator.clipboard.writeText('1342645761');
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const handleSendMessage = (e) => {
    e.preventDefault();
    if (inputMessage.trim()) {
      // Tambahkan pesan baru ke awal list
      const newItem = `Dukungan Baru: ${inputMessage}`;
      setMessages([newItem, ...messages]); 
      
      setInputMessage("");
      setIsMessageSent(true);
      setTimeout(() => setIsMessageSent(false), 3000);
    }
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex flex-col">
      
      {/* Running Text Section */}
      <div className="bg-slate-900 text-white py-2 overflow-hidden relative z-20 shadow-md">
        <div className="whitespace-nowrap animate-marquee flex items-center gap-8">
          {messages.map((msg, idx) => (
            <span key={idx} className="flex items-center gap-2 text-sm font-medium text-blue-200">
              <Heart size={14} className="text-red-500 fill-red-500" /> {msg}
            </span>
          ))}
           {/* Duplicate for seamless loop */}
           {messages.map((msg, idx) => (
            <span key={`dup-${idx}`} className="flex items-center gap-2 text-sm font-medium text-blue-200">
              <Heart size={14} className="text-red-500 fill-red-500" /> {msg}
            </span>
          ))}
        </div>
      </div>

      {/* Hero Section */}
      <header className="bg-gradient-to-br from-blue-700 to-slate-800 text-white py-12 px-4 text-center relative overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/rain.png')]"></div>
        <div className="max-w-3xl mx-auto relative z-10">
          <div className="inline-flex items-center gap-2 bg-red-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-4 animate-pulse">
            <AlertTriangle size={14} /> Darurat Bencana
          </div>
          <h1 className="text-3xl md:text-5xl font-extrabold mb-4 leading-tight">
            Aksi Solidaritas Banjir Sumatera
          </h1>
          <p className="text-blue-100 text-lg md:text-xl mb-6 max-w-2xl mx-auto">
            Bantu saudara kita di Aceh, Sumatera Utara, dan Sumatera Barat yang terdampak banjir bandang 26 November lalu.
          </p>
        </div>
      </header>

      {/* Countdown Timer Section */}
      <div className="bg-white shadow-lg rounded-xl mx-4 -mt-10 p-6 max-w-4xl md:mx-auto relative z-20 border border-slate-200">
        <div className="text-center">
          <h2 className="text-slate-500 text-sm font-semibold uppercase tracking-widest mb-4">Batas Akhir Donasi (Hari Ini 22:00 WIB)</h2>
          
          {isExpired ? (
            <div className="bg-red-50 text-red-700 p-6 rounded-lg border border-red-200">
              <h3 className="text-2xl font-bold">Penggalangan Dana Ditutup</h3>
              <p>Terima kasih atas partisipasi luar biasa Anda.</p>
            </div>
          ) : (
            <div className="grid grid-cols-3 gap-4 max-w-md mx-auto">
              <div className="bg-slate-900 text-white p-4 rounded-lg">
                <span className="block text-3xl md:text-5xl font-mono font-bold">{String(timeLeft.hours).padStart(2, '0')}</span>
                <span className="text-xs text-slate-400">Jam</span>
              </div>
              <div className="bg-slate-900 text-white p-4 rounded-lg">
                <span className="block text-3xl md:text-5xl font-mono font-bold">{String(timeLeft.minutes).padStart(2, '0')}</span>
                <span className="text-xs text-slate-400">Menit</span>
              </div>
              <div className="bg-red-600 text-white p-4 rounded-lg shadow-lg shadow-red-200 animate-pulse">
                <span className="block text-3xl md:text-5xl font-mono font-bold">{String(timeLeft.seconds).padStart(2, '0')}</span>
                <span className="text-xs text-red-100">Detik</span>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Donation Details & Action */}
      <main className="flex-grow container mx-auto px-4 py-12 max-w-4xl">
        <div className="grid md:grid-cols-2 gap-8">
          
          {/* Left: Data & Input Form */}
          <div className="space-y-6">
            
            {/* Input Form Section */}
            <div className="bg-white p-5 rounded-xl border border-blue-100 shadow-sm">
              <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2 mb-3">
                <MessageSquare size={20} className="text-blue-600"/>
                Kirim Pesan Semangat
              </h3>
              <form onSubmit={handleSendMessage} className="relative">
                <input 
                  type="text" 
                  value={inputMessage}
                  onChange={(e) => setInputMessage(e.target.value)}
                  placeholder="Tulis doa atau dukunganmu di sini..." 
                  className="w-full pl-4 pr-12 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none text-sm"
                  maxLength={60}
                />
                <button 
                  type="submit"
                  disabled={!inputMessage.trim()}
                  className="absolute right-2 top-2 p-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  <Send size={16} />
                </button>
              </form>
              {isMessageSent && (
                <p className="text-xs text-green-600 mt-2 font-medium animate-pulse">
                  âœ“ Pesan berhasil ditayangkan di running text!
                </p>
              )}
              <p className="text-xs text-slate-400 mt-2">
                *Pesanmu akan muncul otomatis di baris atas.
              </p>
            </div>

            <div className="pt-4">
              <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2 mb-3">
                <span className="bg-blue-100 text-blue-700 p-2 rounded-lg"><CheckCircle size={20}/></span>
                Transparansi Data
              </h3>
              <p className="text-slate-600 leading-relaxed text-sm">
                Donasi dialokasikan untuk kebutuhan mendesak: makanan siap saji, selimut, air bersih, dan obat-obatan.
              </p>
              <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mt-3">
                <h4 className="font-semibold text-blue-800 mb-2 text-sm">Area Fokus Distribusi:</h4>
                <ul className="list-disc list-inside text-slate-700 space-y-1 text-sm">
                  <li>Kabupaten Aceh Tenggara (Aceh)</li>
                  <li>Deli Serdang & Medan (Sumut)</li>
                  <li>Pesisir Selatan (Sumbar)</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Right: Transfer Box */}
          <div className="bg-white p-6 rounded-2xl shadow-xl border border-slate-100">
            <div className="text-center mb-6">
              <p className="text-slate-500 text-sm mb-1">Salurkan bantuan melalui</p>
              <h3 className="text-xl font-bold text-slate-800">Bank Negara Indonesia (BNI)</h3>
            </div>

            <div className="bg-slate-100 p-4 rounded-xl flex items-center justify-between mb-6 group hover:bg-slate-200 transition-colors">
              <div className="text-left">
                <span className="text-xs text-slate-500 uppercase font-semibold">Nomor Rekening</span>
                <p className="text-2xl font-mono font-bold text-slate-900 tracking-wider">1342645761</p>
              </div>
              <button 
                onClick={handleCopy}
                className="bg-white p-2 rounded-lg shadow-sm hover:shadow-md active:scale-95 transition-all text-blue-600"
                title="Salin Nomor"
              >
                {copied ? <CheckCircle size={24} className="text-green-500"/> : <Copy size={24}/>}
              </button>
            </div>

            {copied && (
              <div className="text-center text-green-600 text-sm font-medium mb-4 animate-bounce">
                Nomor rekening berhasil disalin!
              </div>
            )}

            <div className="space-y-3">
              <a 
                href="https://wa.me/6285228029800?text=Halo,%20saya%20sudah%20transfer%20donasi%20untuk%20banjir%20Sumatera.%20Berikut%20buktinya:"
                target="_blank"
                rel="noreferrer"
                className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-3 transition-all transform hover:-translate-y-1 shadow-lg shadow-green-200"
              >
                <Phone size={20} />
                Konfirmasi Transfer (WhatsApp)
              </a>
              <p className="text-center text-xs text-slate-400">
                Wajib konfirmasi ke +62 852-2802-9800 setelah transfer.
              </p>
            </div>
          </div>

        </div>
      </main>

      {/* Footer */}
      <footer className="bg-slate-900 text-slate-400 py-8 text-center border-t border-slate-800">
        <div className="container mx-auto px-4">
          <p className="mb-2">Posko Bersama Peduli Sumatera</p>
          <p className="text-xs">&copy; 2025 Solidaritas Kemanusiaan. Batas akhir: 6 Des 2025, 22:00 WIB.</p>
        </div>
      </footer>

      <style>{`
        @keyframes marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
        .animate-marquee {
          animation: marquee 30s linear infinite;
        }
      `}</style>
    </div>
  );
};

export default FloodReliefApp;
